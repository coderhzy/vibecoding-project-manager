# code-review

在代码提交前自动进行代码审查，确保代码质量。

## 触发条件

### 自动触发
- 完成一个功能实现后
- 准备提交代码前
- 修改文件数量 >= 3
- 检测到关键文件被修改

### 手动触发
- `/review`
- `/review:quick` (快速审查)
- `/review:deep` (深度审查)

## 审查维度

### 1. 代码正确性

```
- 逻辑是否正确？
- 边界条件是否处理？
- 错误处理是否完善？
- 类型是否正确？
```

### 2. 安全性

```
OWASP Top 10 检查：
- [ ] 注入攻击（SQL、命令、XSS）
- [ ] 认证/授权漏洞
- [ ] 敏感数据泄露
- [ ] 不安全的反序列化
- [ ] 安全配置错误
```

### 3. 性能

```
- N+1 查询问题
- 不必要的重复计算
- 内存泄漏风险
- 阻塞操作
- 缓存使用
```

### 4. 可维护性

```
- 代码可读性
- 命名规范
- 函数/类职责单一
- 重复代码
- 复杂度控制
```

### 5. 测试覆盖

```
- 关键路径是否有测试
- 边界条件测试
- 错误情况测试
- 测试质量
```

## 审查级别

### Quick Review (快速)

耗时：~30秒
覆盖：
- 语法错误
- 明显的 bug
- 安全漏洞（高危）
- 代码风格

### Standard Review (标准)

耗时：~2分钟
覆盖：
- Quick Review 所有内容
- 逻辑正确性
- 性能问题
- 测试建议

### Deep Review (深度)

耗时：~5分钟
覆盖：
- Standard Review 所有内容
- 架构合理性
- 设计模式使用
- 长期维护性
- 重构建议

## 输出格式

```markdown
# Code Review Report

## 概览

- **审查级别**：Standard
- **文件数量**：5
- **代码行数**：+234 -56
- **总体评分**：B+ (85/100)

## 发现问题

### 🔴 严重 (必须修复)

#### [S-001] SQL 注入风险
- **文件**：`src/api/users.ts:45`
- **问题**：直接拼接 SQL 查询
- **建议**：使用参数化查询
```typescript
// 修复前
const query = `SELECT * FROM users WHERE id = ${id}`;
// 修复后
const query = `SELECT * FROM users WHERE id = $1`;
```

### 🟡 中等 (建议修复)

#### [M-001] 缺少错误处理
- **文件**：`src/services/auth.ts:78`
- **问题**：未处理 token 解析失败
- **建议**：添加 try-catch

### 🟢 轻微 (可选修复)

#### [L-001] 变量命名
- **文件**：`src/utils/helper.ts:12`
- **问题**：变量名 `d` 不够描述性
- **建议**：改为 `dateString`

## 亮点

- ✨ 良好的类型定义
- ✨ 清晰的函数拆分
- ✨ 完善的错误消息

## 建议

1. 添加单元测试覆盖新增功能
2. 考虑提取公共逻辑到 utils
3. 更新相关文档

## 可以提交？

⚠️ **建议修复严重问题后再提交**
```

## 自动修复

对于简单问题，提供自动修复：

```
发现 3 个可自动修复的问题：
1. [L-001] 变量命名
2. [L-003] 缺少分号
3. [L-004] 多余空行

是否自动修复？(y/n)
```

## 与 Git 集成

审查通过后，自动触发：
- 更新审查记录到会话
- 准备提交（触发 git-commit skill）
- 更新 TODO 状态
