# daily-log

全自动按日期维度记录开发全流程，每个步骤自动留存文档。

## 核心理念

**全自动**：你只需要说"做什么"，其他全部自动处理
**按日期**：所有记录按日期组织，便于回溯
**全流程**：需求→TODO→执行→验证→归档，每步都有记录

## 触发条件

**始终自动运行**，贯穿整个开发过程：
- 对话开始 → 自动创建/加载当日日志
- 提出需求 → 自动记录需求
- 生成计划 → 自动记录计划
- 执行任务 → 自动记录进展
- 完成验证 → 自动记录结果
- 会话结束 → 自动归档总结

## 文档结构

```
.claude/daily/
├── 2024/
│   └── 01/
│       ├── 10.md          # 2024-01-10 的完整记录
│       ├── 11.md          # 2024-01-11 的完整记录
│       └── ...
└── archive/               # 月度/季度归档
    └── 2024-Q1.md
```

## 每日文档格式

```markdown
# 开发日志 - 2024-01-10

> 自动生成，请勿手动修改核心结构

## 📋 今日概览

| 指标 | 数值 |
|------|------|
| 开始时间 | 09:30 |
| 结束时间 | 18:00 |
| 会话数 | 3 |
| 完成任务 | 5/7 |
| 提交数 | 3 |

---

## 🎯 需求记录

### [09:32] 需求 #1：用户登录功能

**原始描述**：
> 帮我实现一个用户登录功能，要支持手机号和邮箱登录

**需求分析**：
- 功能：用户认证系统
- 包含：手机号登录、邮箱登录、JWT Token
- 不包含：第三方登录、注册功能
- 技术方案：JWT + bcrypt

**确认状态**：✅ 用户已确认

---

## 📝 TODO 清单

### 需求 #1 的任务分解

| # | 任务 | 状态 | 开始 | 完成 | 耗时 |
|---|------|------|------|------|------|
| 1 | 设计用户数据模型 | ✅ | 09:45 | 10:12 | 27m |
| 2 | 实现登录接口 | ✅ | 10:15 | 11:30 | 1h15m |
| 3 | 实现 JWT 生成 | ✅ | 11:35 | 12:00 | 25m |
| 4 | 添加密码加密 | ✅ | 14:00 | 14:20 | 20m |
| 5 | 编写单元测试 | ⏳ | 14:25 | - | - |
| 6 | 接口文档 | ⏸️ | - | - | - |

---

## 🔨 执行记录

### [09:45] Task #1: 设计用户数据模型

**执行内容**：
- 创建 `src/models/user.ts`
- 定义 User 接口和 Schema
- 添加索引优化

**修改文件**：
```
+ src/models/user.ts (45 lines)
+ src/types/user.d.ts (12 lines)
M prisma/schema.prisma (+15 -0)
```

**代码片段**：
```typescript
// src/models/user.ts
export interface User {
  id: string;
  email?: string;
  phone?: string;
  passwordHash: string;
  createdAt: Date;
}
```

---

### [10:15] Task #2: 实现登录接口

**执行内容**：
- 创建登录路由
- 实现邮箱/手机号双重验证
- 添加错误处理

**修改文件**：
```
+ src/api/auth/login.ts (78 lines)
+ src/api/auth/index.ts (15 lines)
M src/app.ts (+3 -0)
```

**关键决策**：
- 选择 bcrypt 而非 argon2（团队更熟悉）
- Token 有效期设为 2 小时

---

## ✅ 验证记录

### [14:30] 验证：登录功能

**测试方式**：单元测试 + 手动测试

**测试结果**：
```
✓ 邮箱登录成功 (45ms)
✓ 手机号登录成功 (38ms)
✓ 错误密码返回401 (12ms)
✓ 不存在用户返回404 (8ms)
✗ 并发登录测试 (超时)

4 passed, 1 failed
```

**问题发现**：
- 并发登录有性能问题，需要添加限流

**用户确认**：✅ 基本功能通过，并发问题加入后续TODO

---

## 📦 提交记录

### [12:05] Commit #1
```
feat(auth): add user model and login endpoint

- Add User model with email/phone support
- Implement login API with JWT
- Add password hashing with bcrypt
```
Files: 5 changed, +150 -3

### [14:35] Commit #2
```
test(auth): add login unit tests

- Add tests for email/phone login
- Add error case tests
```
Files: 2 changed, +89 -0

---

## 🗂️ 日终归档

### 今日成果
- ✅ 完成用户登录功能核心实现
- ✅ 单元测试覆盖率 85%
- ⏳ 接口文档待完成

### 遗留问题
1. 并发登录性能问题 → 转入明日 TODO
2. 接口文档 → 转入明日 TODO

### 明日计划
- [ ] 修复并发登录问题
- [ ] 完成接口文档
- [ ] 开始注册功能

### 知识沉淀
- JWT Token 刷新机制设计方案记录在 `decisions.md`
- bcrypt vs argon2 对比记录

---

## 📊 统计

- **代码量**：+320 -15
- **文件数**：8 个新增，3 个修改
- **测试覆盖**：85%
- **文档更新**：API.md, README.md
```

## 自动化流程

```
用户说话
    │
    ▼
┌─────────────────────────────────────────────────────┐
│ [daily-log] 自动判断阶段                              │
├─────────────────────────────────────────────────────┤
│                                                     │
│  "帮我做xxx" ──→ 记录到【需求记录】                    │
│       │                                             │
│       ▼                                             │
│  [plan-maker] ──→ 记录到【TODO清单】                  │
│       │                                             │
│       ▼                                             │
│  [todo-runner] ──→ 记录到【执行记录】                 │
│       │                                             │
│       ▼                                             │
│  "测试一下" ──→ 记录到【验证记录】                     │
│       │                                             │
│       ▼                                             │
│  [git-commit] ──→ 记录到【提交记录】                  │
│       │                                             │
│       ▼                                             │
│  会话结束 ──→ 生成【日终归档】                        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

## 检查点（仍然保留）

虽然全自动，但关键节点仍会提示确认：

```
📍 需求确认
我理解你要做：{需求描述}
确认正确？(y/n)

📍 计划确认
生成了 5 个任务，确认开始执行？(y/n)

📍 验证确认
测试结果：4 passed, 1 failed
是否继续？(y/n)
```

## 查看历史

```
/daily:today     # 查看今日日志
/daily:yesterday # 查看昨日日志
/daily:2024-01-10 # 查看指定日期
/daily:week      # 查看本周汇总
/daily:search "登录" # 搜索历史记录
```
