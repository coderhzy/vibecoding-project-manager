# todo-runner

自动执行 TODO 列表中的任务，实现连续开发流。

## 触发条件

### 自动触发
- 完成当前任务后，自动获取下一个
- 用户确认"继续"时
- 检测到待办队列有任务

### 手动触发
- `/project:nextTODO`
- 用户明确要求执行下一个任务

## 任务格式

### TODO.md 标准格式

```markdown
# TODO

## 当前迭代

### 高优先级
- [ ] #task-001 {任务描述} @{负责人} !{截止日期}
- [x] #task-002 {已完成任务}

### 中优先级
- [ ] #task-003 {任务描述}

### 低优先级
- [ ] #task-004 {任务描述}

## Backlog

- [ ] #backlog-001 {待排期任务}
```

### 任务标记说明

| 标记 | 含义 |
|------|------|
| `- [ ]` | 未完成 |
| `- [x]` | 已完成 |
| `- [-]` | 已取消 |
| `- [~]` | 进行中 |
| `#task-xxx` | 任务ID |
| `@name` | 负责人 |
| `!date` | 截止日期 |
| `>>file` | 相关文件 |

## 执行流程

### 1. 读取任务队列

```
读取 .claude/TODO.md
解析所有 - [ ] 开头的未完成任务
按优先级排序：高 > 中 > 低
```

### 2. 选择下一个任务

优先级规则：
1. 高优先级中的第一个未完成任务
2. 中优先级中的第一个未完成任务
3. 低优先级中的第一个未完成任务
4. Backlog 中的任务（需用户确认）

### 3. 任务执行

```
1. 标记任务为进行中：- [ ] → - [~]
2. 分析任务要求
3. 执行任务（代码修改/文档更新/等）
4. 验证完成
5. 标记任务完成：- [~] → - [x]
6. 记录完成时间和说明
```

### 4. 后续处理

- 更新 `activeContext.md`
- 同步会话记录
- 提示用户是否继续

## 任务分解

当任务过大时，自动分解：

```markdown
原任务：
- [ ] #task-001 实现用户认证系统

分解为：
- [ ] #task-001 实现用户认证系统
  - [ ] #task-001-a 设计数据模型
  - [ ] #task-001-b 实现注册接口
  - [ ] #task-001-c 实现登录接口
  - [ ] #task-001-d 实现 JWT 验证
  - [ ] #task-001-e 编写测试
```

## 阻塞处理

当任务被阻塞时：

```markdown
- [!] #task-003 {任务描述}
  - 阻塞原因：{原因}
  - 依赖：#task-002
  - 需要：{需要什么才能继续}
```

## 完成报告

每个任务完成后生成：

```
✅ 任务完成：#task-001 {任务描述}

修改文件：
- src/auth/login.ts (+45 -12)
- src/models/user.ts (+23 -0)

下一个任务：
- [ ] #task-002 {下一个任务描述}

是否继续？(y/n)
```

## 批量执行

支持自动连续执行多个任务：

```
/project:runAll        # 执行所有高优先级任务
/project:runUntil xxx  # 执行直到某个任务
```

## 安全机制

### NEVER 自动执行
- 删除文件/数据的任务
- 部署/发布相关任务
- 涉及敏感配置的任务
- 标记为需要确认的任务

### ALWAYS 需要确认
- 首次执行时
- 任务涉及多个模块
- 检测到潜在风险
