# 06 - 工具元认知

> 精确控制 Agent 何时、如何使用工具。

## 工具使用三要素

### 1. 触发条件（When to Use）

```markdown
# 工具：读取素材库
触发条件：
- 用户询问关于素材的问题
- 需要引用具体素材来支撑建议
- 开始新的创作任务前

不触发条件：
- 只是闲聊
- 用户在讨论已经读取过的素材
- 用户明确说不需要参考素材
```

### 2. 使用策略（How to Use）

```markdown
# 工具：搜索代码
使用策略：
- 先用宽泛的关键词搜索
- 如果结果太多，增加限定条件
- 如果结果为空，尝试同义词
- 最多搜索 3 次，避免过度搜索
```

### 3. 结果处理（What to Do with Results）

```markdown
# 工具返回后
- 空结果：告知用户，建议调整搜索条件
- 少量结果：直接展示给用户
- 大量结果：总结要点，询问用户想深入了解哪个
- 错误：说明问题，提供替代方案
```

## 工具元认知模板

```markdown
# 工具使用

## 工具 A：{工具名}

### 用途
{这个工具是做什么的}

### 触发条件
使用：
- {触发条件1}
- {触发条件2}

不使用：
- {不触发条件1}
- {不触发条件2}

### 使用策略
- {策略1}
- {策略2}

### 结果处理
- 成功：{处理方式}
- 空结果：{处理方式}
- 错误：{处理方式}

---

## 工具 B：{工具名}
...
```

## 常见问题

### 1. 过度使用工具

```
❌ 每次对话都调用搜索工具
✅ 只在需要外部信息时调用

解决：在触发条件中增加「不触发条件」
```

### 2. 工具调用顺序错误

```
❌ 先写代码，再搜索参考
✅ 先搜索参考，再写代码

解决：在使用策略中明确顺序
```

### 3. 忽略工具结果

```
❌ 调用工具后不使用返回的数据
✅ 根据工具返回调整输出

解决：在结果处理中明确如何使用数据
```

### 4. 工具调用死循环

```
❌ 结果不满意就一直调用
✅ 设置最大调用次数

解决：在使用策略中设置上限
```

## Handoff 工具特殊说明

当 Agent 系统使用 Handoff 模式时：

```markdown
# Handoff 工具

## 用途
将任务交接给其他 Agent

## 触发条件
使用：
- 用户确认了方向，需要下一步执行
- 当前 Agent 无法完成的任务

不使用：
- 用户还在探索，没有确认
- 当前 Agent 可以完成的任务

## 重要
- Handoff 是路由信号，不执行业务逻辑
- 调用后当前 Agent 结束，下游 Agent 接管
- 必须传递完整的上下文给下游
```

## 检查清单

- [ ] 每个工具是否定义了触发条件？
- [ ] 是否有「不触发条件」防止过度使用？
- [ ] 是否定义了使用策略和顺序？
- [ ] 是否定义了各种结果的处理方式？
- [ ] 是否设置了调用次数上限？
